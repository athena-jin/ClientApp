@page "/"
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Buttons
@using WebAPI.Data

<SfGrid DataSource="@machines" AllowPaging="true" AllowSorting="true"
            @bind-SelectedRowIndex="selectedRowIndex">
           @*  <GridSelectionSettings Mode="SelectionMode.Row">

            </GridSelectionSettings> *@
    <GridColumns>
        <GridColumn Field="Id" HeaderText="Id" IsPrimaryKey="true" Visible="false" />
        <GridColumn Field="Name" HeaderText="Name" Width="150" />
        <GridColumn Field="Address" HeaderText="IP Address" Width="150" />
        <GridColumn Field="Port" HeaderText="Port" Width="100" />
        <GridColumn Field="Status" HeaderText="Status" Width="100" />
    </GridColumns>
</SfGrid>
@* @if (selectedMachine != null)
{
    <SfButton Content="View Details" OnClick="NavigateToMachineDetails"></SfButton>
} *@

@code{
    #nullable disable
    [Inject]
    public MyODataServiceContext ODataService { get; set; }
    private List<Machine> machines = new List<Machine>();
    private int selectedRowIndex = -1;
    private Machine? selectedMachine;
    protected override void OnInitialized()
    {
        var temp = ODataService.Machines.ToList();
        machines.Clear();
        machines.AddRange(temp);
        //machines = new List<Machine>() { temp };
    }
    // protected override async Task OnInitializedAsync()
    // {
    //     var temp = await ODataService.Machines.ExecuteAsync();
    //     machines.Clear();
    //     machines.Concat(temp);
    //     //machines = new List<Machine>() { temp };
    // }

    private void NavigateToMachineDetails()
    {
        // if (selectedRowIndex >= 0 && selectedRowIndex < machines.Count)
        // {
        //     selectedMachine = machines[selectedRowIndex];
        //     NavigationManager.NavigateTo($"/machineDetails/{selectedMachine.Id}");
        // }
    }
}